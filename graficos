import matplotlib.pyplot as plt
import csv

#ABRIR ARCHIVO
with open('Play_Store_Data.csv', 'r', encoding = 'utf-8') as archivo:
    lector = csv.reader(archivo)
    datos = []
    for fila in lector:
        datos.append(fila)
    cabecera = datos[0]
    data = datos[1:]

#GRÁFICO DE APPS POR CATEGORÍA

categorias_apps = {}
for fila in data:
    categoria = fila[cabecera.index("Category")]
    if categoria in categorias_apps:
        categorias_apps[categoria]+=1
    else:
        categorias_apps[categoria] = 1

#ORDENADO DE MAYOR A MENOR
ordenado_cat = dict(sorted(categorias_apps.items(), key = lambda x: x[1], reverse = True))

categorias = list(ordenado_cat.keys())
cantidad = list(ordenado_cat.values())

plt.bar(categorias, cantidad)
plt.xlabel("Categoría")
plt.ylabel("Juegos por categoría")
plt.title("Categorías App Store")
plt.xticks(rotation=90)
plt.show()

#CATEGORIA POR PROMEDIO DE RATINGS

categorias_rat = {}
for fila in data:
    categoria = fila[cabecera.index("Category")]
    if fila[2] == "NaN":
            rating = 0
    else:
        rating = float(fila[2])
    if categoria in categorias_rat:
        
        categorias_rat[categoria]+= rating
    else:
        categorias_rat[categoria] = rating

for i in categorias_rat.keys():
    categorias_rat[i] = categorias_rat[i]/categorias_apps[i]

ordenado_rating = dict(sorted(categorias_rat.items(), key = lambda x: x[1], reverse = True))
categorias = list(ordenado_rating.keys())
media = list(ordenado_rating.values())

plt.bar(categorias, media)
plt.xlabel("Categoría")
plt.ylabel("Promedio de rating")
plt.title("Promedio de rating de aplicación por categoría")
plt.xticks(rotation=90)
plt.show()



#GÉNEROS CON AL MENOS 3 APLICACIONES PAGAS

genero_desc = {}
for fila in data:
    precio = fila[cabecera.index("Type")]
    genero = fila[cabecera.index("Genres")]

    if genero in genero_desc and precio != "Free":
        genero_desc[genero]+= 1
    elif genero not in genero_desc and precio != "Free":
        genero_desc[genero] = 1

ordenado_genero_pagas = dict(sorted(genero_desc.items(), key = lambda x: x[1], reverse = True))
#FILTRO PARA BORRAR LOS GÉNEROS CON SOLO UNA APP
generos_filtrados = {genero: pagos for genero, pagos in ordenado_genero_pagas.items() if pagos >= 3}
generos = list(generos_filtrados.keys())
pagos = list(generos_filtrados.values())

plt.bar(generos, pagos)
plt.xlabel("Género")
plt.ylabel("Aplicaciones pagas")
plt.title("Aplicaciones pagas por género")
plt.xticks(rotation=90)
plt.show()

#PROPORCION DE CONTENT RATING

publicos_lista = {}
for fila in data:
    publicos = fila[cabecera.index("Content Rating")]
    if publicos in publicos_lista:
        publicos_lista[publicos]+= 1
    else:
        publicos_lista[publicos] = 1

publicos_fin = list(publicos_lista.keys())
cant = list(publicos_lista.values())
plt.pie(cant, labels = publicos_fin, autopct="%1.2f%%", labeldistance=1.1, rotatelabels=True)
#OJO ACA QUE ALGUNOS LABELS SE SUPERPONEN
plt.title("Categorías de edad", loc = "center")
plt.show()

#PROMEDIO DE PRECIO DE APPS PAGAS POR CAT.

